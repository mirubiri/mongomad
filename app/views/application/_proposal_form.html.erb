
<%
  if controller.controller_name == "offers"
    @form_model = @offer
    @receiver_id = id(@user)
    @receiver_image =  offer_modal_user_image(@user)
    @composer_id = id(@user)
    @composer_image = offer_modal_user_image(@user)
    @receiver_items = @user.items.desc(:updated_at)
    @composer_items = @user.items.desc(:updated_at)
    @offer_send_button_id = "new-offer-send-button"

  else
    @form_class = @offer
    @form_id = "new-offer-form"
    @form_model = @negotiation
    @receiver_id = "id(@user)"
    @receiver_image =  "offer_modal_user_image(@user)"
    @composer_id = "id(@user)"
    @composer_image = "offer_modal_user_image(@user)"
    @receiver_items = @user.items.desc(:updated_at)
    @composer_items = @user.items.desc(:updated_at)
    @offer_send_button_id = "new-offer-send-button"
  end
%>


<div class="<%= @form_class %>" id="<%= @form_id %>">
  <%= form_for [@user,@offer], :remote => true do |form| %>
    <div class="products_area">
      <div class="title">
        <a href="#blank" id="new_offer_receiver_selector" value="<%= @receiver_id %>">
          <div class="user_products_selector" id="receiver_selector_area">
            <div class="user_image">
              <%= @receiver_image %>
            </div>
          </div>
        </a>
        <a href="#blank" id="new_offer_composer_selector" value="<%= @composer_id %>">
          <div class="user_products_selector" id="composer_selector_area">
            <div class="user_image">
              <%= @composer_image %>
            </div>
          </div>
        </a>
        <a href="#blank" id="new_message_selector" value="<%= id(@user) %>">
          <div class="user_products_selector" id="message_selector_area">
            <div class="user_image">
              <%= initial_message_icon %>
            </div>
          </div>
        </a>
      </div>
      <div class="products_container">
        <div class="products_list">
          <div id="receiver_content_area">

            <div class="item" id="receiver_money" side="left" type="Cash">
              <div class="item_image">
                <%= money_image %>
              </div>
              <div class="item_description">
                <div class="text">
                  <textarea rows="1" placeholder="0€"></textarea>
                </div>
              </div>
            </div>

            <% @receiver_items.each do |item| %>
              <div class="item" id="<%= id(item) %>" side="left" type="Product">
                <div class="item_image">
                  <%= offer_modal_receiver_product_image(item) %>
                </div>
                <div class="item_description">
                  <div class="text">
                    <%= name(item) %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          <div id="composer_content_area" class="hidden_container">

            <div class="item" id="composer_money" side="right" type="Cash">
              <div class="item_image">
                <%= money_image %>
              </div>
              <div class="item_description">
                <div class="text">
                  <textarea rows="1" placeholder="0€"></textarea>
                </div>
              </div>
            </div>

            <% @composer_items.each do |item| %>
              <div class="item" id="<%= id(item) %>" side="right" type="Product">
                <div class="item_image">
                  <%= offer_modal_composer_product_image(item) %>
                </div>
                <div class="item_description">
                  <div class="text">
                    <%= name(item) %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
          <div id="message_content_area" class="hidden_container">
            Aqui vendra el text area de la oferta
          </div>
        </div>
        <div class="product_overview">
          <div class="overview_image" id="overview_image">Imagen</div>
          <div class="overview_image" id="overview_image">Imagen</div>
          <div class="overview_image" id="overview_image">Imagen</div>
          <div class="overview_description">
            <div class="overview_description_title" id="overview_description_title">Titulo del producto</div>
            <div class="overview_description_text" id="overview_description_text">Descripcion del producto</div>
          </div>
        </div>
      </div>
    </div>

    <input type="hidden" name="offer[receiver_id]" value="<%= id(@user) %>" />
    <input type="hidden" name="offer[initial_message]" value="this is the first message in offer" />


    <% if controller.controller_name == "offers" && controller.action_name == "new" %>
      <div class="offer_summary" id="offer_summary" maxItems="0">
        <div class="offer_inform">
          <div class="offer_header">
            <%= nick(@user).capitalize %>
          </div>
          <div class="offer_products">
            <div class="summaryleft">
                <div class="money_received" id="dineroPidesEnSumario">
                  <div class="money_composition"></div>
                </div>
            </div>
            <div class="summaryright">
              <div class="money_given" id="dineroOfrecesEnSumario">
                <div class="money_composition"></div>
              </div>
            </div>
          </div>
          <div class="offer_info">
            <div class="profile_image">
              <%= @composer_image %>
            </div>
            <div class="description">
              <div class="offer_message">
                <%= form.text_area :message, :placeholder => "First Message", :rows => "2" %>
              </div>
            </div>
            <div class="offer_buttons">
              <%= form.submit "Submit", :url => user_offers_path(@user), :class => 'offer_buttons_style', :id => @offer_send_button_id %>
              <button class="offer_buttons_style">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    <% else%>

      <% @receiver_products = receiver_products(@offer) %>
      <% @receiver_products = receiver_products(@offer) %>

      <div class="offer_summary" id="offer_summary" maxItems="0">
        <div class="offer_inform">
          <div class="offer_header">
            <%= nick(@user).capitalize %>
          </div>
          <div class="offer_products">
            <div class="summaryleft">
              <% contador = 0 %>
              <% @composer_products.each do |product| %>
                <div class="item newitem" id="<%= id(product) %>"  side="left" type="Product">
                  <div class="item_image" style="width: 151.6px; height: 151.6px;">
                    <%= offer_modal_receiver_product_image(product) %>
                  </div>
                  <div class="item_description">
                    <div class="text">
                      <%= name(product) %>
                    </div>
                  </div>
                  <div class="data_input">
                    <input type="hidden" name="offer[goods][<%= contador %>][item_id]" value="<%= id(product) %>">
                    <input type="hidden" name="offer[goods][<%= contador %>][type]" value="Product">
                  </div>
                </div>
                <% contador += 1 %>
              <% end %>
              <div class="money_received" id="dineroPidesEnSumario">
                <div class="money_composition"></div>
                <div class="data_input"><!--
                  <input type="hidden" name="offer[goods][<% contador %>][item_id]" value="<%#= id(product) %>">
                  <input type="hidden" name="offer[goods][<% contador %>][type]" value="Cash">
                  <input type="hidden" name="offer[goods][<% contador %>][Quantity]" value="<%#= quantity(product) %>">
                 --></div>
              </div>
            </div>


            <div class="summaryright">
              <% contador = 0 %>
              <% @receiver_products.each do |product| %>
                <div class="item newitem" id="<%= id(product) %>"  side="right" type="Product">
                  <div class="item_image">
                    <%= offer_modal_composer_product_image(product) %>
                  </div>
                  <div class="item_description">
                    <div class="text">
                      <%= name(product) %>
                    </div>
                  </div>
                   <div class="data_input">
                    <input type="hidden" name="offer[goods][<%= contador %>][item_id]" value="<%= id(product) %>">
                    <input type="hidden" name="offer[goods][<%= contador %>][type]" value="Product">
                  </div>
                </div>
                <% contador += 1 %>
              <% end %>
              <div class="money_given" id="dineroOfrecesEnSumario">
                <div class="money_composition"></div>
                <div class="data_input"><!--
                  <input type="hidden" name="offer[goods][<% contador %>][item_id]" value="<%#= id(product) %>">
                  <input type="hidden" name="offer[goods][<% contador %>][type]" value="Cash">
                  <input type="hidden" name="offer[goods][<% contador %>][Quantity]" value="<%#= quantity(product) %>">
                 --></div>
              </div>
            </div>
          </div>
          <div class="offer_info">
            <div class="profile_image">
              <%= @composer_image %>
            </div>
            <div class="description">
              <div class="offer_message">
                <%= form.text_area :message, :placeholder => "First Message", :rows => "2" %>
              </div>
            </div>
            <div class="offer_buttons">
              <%= form.submit "Submit", :class => 'offer_buttons_style', :id => @offer_send_button_id %>
              <button class="offer_buttons_style">Cancel</button>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
