<% user_logged_negotiations.each do |negotiation| %>
  <div class="negotiation" id="negotiation<%= negotiation.id %>">

    <div class="negotiation_offer">
      <div class="offer_header">
        <div class="triangle">
            <!--<img src="http://localhost:3000/images/optionsicon.png" alt="options" id="options_button"> -->
        </div>
        <div class="profile_image">
          <%= link_to proposal_composer_image(negotiation_last_proposal(negotiation)),
            :controller => "users",
            :action => "show",
            :id => proposal_composer_id(negotiation_last_proposal(negotiation))
          %>
        </div>
        <div class="description">
          <div class="composer_name">
            <%= proposal_composer_name(negotiation_last_proposal(negotiation)) %>
          </div>
        </div>
      </div>
      <div class="offer_things">
        <div class="recieved">
          <% proposal_composer_products(negotiation_last_proposal(negotiation)).each do |product| %>
            <div class="image_container">
              <%= product_image(product) %>
              <div class="quantity_container">
                <%= product_quantity(product) %>
              </div>
            </div>
          <% end %>
        </div>
        <div class="given">
          <% proposal_receiver_products(negotiation_last_proposal(negotiation)).each do |product| %>
            <div class="image_container">
              <%= product_image(product) %>
              <div class="quantity_container"><%= product_quantity(product) %></div>
            </div>
          <% end %>
        </div>
      </div>
      <div class="offer_buttons">        
        <%= link_to 'new proposal',
            edit_user_negotiation_path(current_user,negotiation_id(negotiation)),
            :remote => true,
            :class => "btn btn-warning" %> 
                 
        <% if (proposal_can_sign?(negotiation_last_proposal(negotiation),current_user)) %>        
          <%= link_to 'firmar',
              sign_user_negotiation_path(current_user.id,negotiation_id(negotiation)),
              :remote => true,
              :class => "btn btn-success" %>       
        <% end %>

        <% if (proposal_can_confirm?(negotiation_last_proposal(negotiation),current_user)) %>
          <%= link_to 'confirmar',
              confirm_user_negotiation_path(current_user.id,negotiation_id(negotiation)),
              :remote => true,
              :class => "btn btn-success" %>
        <% end %>

        <% if (proposal_can_cancel?(negotiation_last_proposal(negotiation),current_user)) %>
          <%= link_to 'cancelar',
              cancel_user_negotiation_path(current_user.id,negotiation_id(negotiation)),
              :remote => true,
              :class => "btn btn-danger" %>        
        <% end %>
      </div>
      <div style="float:left; text-align:center; color:red; width:100%">
        <%= negotiation_last_proposal(negotiation).state %>        
      </div>
      <div class="offer_date">
        <%#= negotiation_datetime(negotiation) %>
      </div>
    </div>

    <div class="dialog_container">
      <div class="dialog_head">
        <div class="dialogin">Conversation...</div>
        <%= link_to "x",
              user_negotiation_path(current_user,negotiation.id),
              :method => :delete,
              :confirm => "Are you sure?"
        %>
      </div>
      <div class="conversation" id="conversationofnegotiation">
        <% negotiation.conversation.messages.each do |message| %>
          <div class="comment">
            <div class="comment_user_image">
              <%= image_tag(message_image(message)) %>
            </div>
            <div class="comment_text">
              <%= message_text(message) %>
            </div>
            <div class="comment_datetime">
              <%= message_datetime(message) %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="writting_box">        
        <%= form_for @negotiation, :url => addComment_user_negotiation_path(current_user.id, negotiation.id), :remote => true do |f| %>
          <div class="message">
            <input type="text" placeholder="write here" name="text">
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>