<div class="negotiation" id="<%= negotiation_id(negotiation) %>">

  <div class="negotiation_offer">
    <div class="offer_header">
      <%= proposal_composer_fullname(negotiation_last_proposal(negotiation)).upcase %>
    </div>

    <div class="offer_triangle">
      <div class="triangle"></div>
    </div>

    <div class="offer_things">
      <div class="recieved">
        <% proposal_composer_products(negotiation_last_proposal(negotiation)).each do |product| %>
          <div class="image_container">
            <%= product_image(product) %>
            <div class="quantity_container">
              <%= product_quantity(product) %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="given">
        <% proposal_receiver_products(negotiation_last_proposal(negotiation)).each do |product| %>
          <div class="image_container">
            <%= product_image(product) %>
            <div class="quantity_container"><%= product_quantity(product) %></div>
          </div>
        <% end %>
      </div>
    </div>

    <div class="offer_info">
      <div class="profile_image">
        <%= link_to proposal_composer_image(negotiation_last_proposal(negotiation)),
          :controller => "users",
          :action => "show",
          :id => proposal_composer_id(negotiation_last_proposal(negotiation))
        %>
      </div>

      <div class="offer_buttons">
        <%= link_to 'nueva',
            edit_user_negotiation_path(current_user,negotiation_id(negotiation)),
            :remote => true,
            :class => "btn btn-small btn-warning" %>

        <% if (proposal_can_sign?(negotiation_last_proposal(negotiation),current_user)) %>
          <%= link_to 'firmar',
              sign_user_negotiation_path(current_user.id,negotiation_id(negotiation)),
              :remote => true,
              :class => "btn btn-small btn-success" %>
        <% end %>

        <% if (proposal_can_confirm?(negotiation_last_proposal(negotiation),current_user)) %>
          <%= link_to 'confirmar',
              confirm_user_negotiation_path(current_user.id,negotiation_id(negotiation)),
              :remote => true,
              :class => "btn btn-small btn-success" %>
        <% end %>

        <% if (proposal_can_cancel?(negotiation_last_proposal(negotiation),current_user)) %>
          <%= link_to 'cancel',
              cancel_user_negotiation_path(current_user.id,negotiation_id(negotiation)),
              :remote => true,
              :class => "btn btn-small btn-danger" %>
        <% end %>
      </div>
          <!--
          <div class="offer_date">
            <%#= offer_datetime(offer) %>
          </div>
          -->
    </div>
  </div>

  <div class="dialog_container">
    <div class="dialog_head">
      <div class="dialogin">Conversation...</div>
      <%= link_to "x",
            user_negotiation_path(current_user,negotiation_id),
            :method => :delete,
            :confirm => "Are you sure?"
      %>
    </div>

    <div class="conversation" id="conversationofnegotiation">
      <%= render :partial => 'negotiations/partials/conversation', locals: { negotiation: negotiation} %>
    </div>

    <div class="writting_box">
      <%= form_for @negotiation, :url => addComment_user_negotiation_path(current_user.id, negotiation_id), :remote => true do |f| %>
        <div class="message">
          <input type="text" placeholder="write here" name="text">
        </div>
      <% end %>
    </div>
  </div>
</div>

