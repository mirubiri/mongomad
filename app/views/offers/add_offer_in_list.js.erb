//Lo primero es ocultar la modal, porque ya se va a generar lo que queremos
$('#new-offer-form').dialog('close');


//Si estabamos mostrando el contenido de que no hay ofertas, lo eliminamos
if( ($('.offer').length) === 0){
  $('#ppal_container > .no_elements').remove();
}


//Agregamos el elemento en el ppal_container con una transicion para que el usuario vea como se añade
//$('#new-offer-form').on('hidden', function () {

  $('#ppal_container').prepend("<%= escape_javascript(render template: 'offers/show', :locals => {:offer => offer, :@negotiation => Negotiation.new}).html_safe %>");
  activateMasonry();
  matchPrincipalContainersHeighs();
  animateNewElement();

  //Elimino la ventana modal de forma definitiva, si no lo hago y abro una nueva, pese a que esté hide, los procesos se lanzaran para cada una
  //delete $(this);
//});



//Helper que permite animar el primer elemento
function animateNewElement(){
  $('#ppal_container')
  .children()
  .first()
  .addClass("new_request_style")
  .css('opacity', 0)
  .hide()
  .slideDown()
  .animate(
    { opacity: 1 },
    { queue: false, duration: 1500 }
  )
  .animate({backgroundColor: '#ffffff'}, 800, function(){
    $(this).removeClass("new_request_style");
  });
}
