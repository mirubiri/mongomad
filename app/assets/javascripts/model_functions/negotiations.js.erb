

(function ($)
{
  $.fn.maximizeConversationWidth = function(){

    var negotiationWidth = $(this).width();
    var proposalOfNegotiationWith = $(this).find('.negotiation_offer').width();
    var conversationWidth = negotiationWidth - proposalOfNegotiationWith;

    $(this).find('.dialog_container').css({'width': conversationWidth + 'px'});

    return $(this);
  };

})(jQuery);


(function ($)
{
  $.fn.maximizeConversationsHeights = function(){

    var alturaOferta = $(this).find(".negotiation_offer").outerHeight(true);
    var alturaNegociacion = $(this).height()-37;
    $(this).css({'max-height': (alturaOferta + 2) +'px'});
    $(this).find(".dialog_container").css({'height': (alturaOferta) +'px'}).css({'max-height': (alturaOferta) +'px'});

    $(this).find('.conversation').css({'height':alturaNegociacion + 'px'});

    return $(this);
  };

})(jQuery);


(function ($)
{
  $.fn.activateNegotiationButtons = function(){

    $(this).hover(
       function () {
          $(this).find('.btn').removeClass("disabled");
       },
       function () {
          $(this).find('.btn').addClass("disabled");
       }
    );

    return $(this);
  };

})(jQuery);


(function ($)
{
  $.fn.disableDoubleScrolling = function(){

    $(this).find('.conversation').hover(
       function () {
          if($(this).has_scrollbar()){
            $("body").css("overflow", "hidden");
          }
       },
       function () {
          if($(this).has_scrollbar()){
            $("body").css("overflow", "auto");
          }
       }
    );

    return $(this);
  };

})(jQuery);


(function ($)
{
  $.fn.focusNegotiationWritebox = function(){

    $(this).on('click', function() {
      $(this).find("input").focus();
    });

    return $(this);
  };

})(jQuery);


(function ($)
{
  $.fn.scrollConversation = function(){

    $(this).find(".conversation").scrollTop($(this).height());

    return $(this);
  };

})(jQuery);

/*
function reloadDialogContainerWidth(){
  var anchuraTotal = $('.negotiation').first().width();
  var anchuraOfferSide = $('.negotiation > .negotiation_offer').first().width();
  var anchuraDialog = anchuraTotal - anchuraOfferSide;
  $('.negotiation > .dialog_container').css({'width': anchuraDialog +'px'});
}
*/

(function($) {
    $.fn.has_scrollbar = function() {
        var divnode = this.get(0);
        if(divnode.scrollHeight > divnode.clientHeight)
            return true;
    }
})(jQuery);


(function($) {
    $.fn.conectToObjectPusherChannel = function() {

      var pusher = new Pusher('APP_KEY');

      var +$(this).attr("id")+ = pusher.subscribe("object_channel_" + $(this).attr("id"));

      var eventName = 'new-comment-in'+$(this).attr("id")+;

      var callback = function(data) {
        $(this).find('conversationofnegotiation').append(
          "<div class='comment'>
            <div class='comment_user_image'>
              <%#= image(message) %>
            </div>
            <div class='comment_text'>
              "+ data +"
            </div>
            <div class='comment_datetime'>
              <%#= date_time(message) %>
            </div>
          </div>");
      };

      pusher.bind(eventName, callback);
    }
})(jQuery);